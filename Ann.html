<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專案開發進度甘特圖</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
    </style>
</head>
<body class="bg-gray-50 p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Intuitive Anvil Channel</h1>
            <p class="text-xl text-gray-600 mt-1">新產品開發進度甘特圖 / New Product Development Schedule</p>
        </header>

        <div id="gantt-container" class="space-y-12">
            <!-- 甘特圖將會動態插入此處 -->
        </div>
    </div>

    <script>
        // 從 Excel 檔案中解析出的專案數據，已加入英文翻譯
        const projects = [
            {
                id: "342405-12 (總)",
                rev: "B",
                tasks: [
                    { name: "雷射焊接", name_en: "Laser Welding", responsible: "綜加課", responsible_en: "Comprehensive Processing", endDate: "2026-01-30" },
                    { name: "鈍化", name_en: "Passivation", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2026-02-03" },
                    { name: "鐵氟龍", name_en: "DryFilm", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2026-02-05" },
                    { name: "檢查1", name_en: "Final Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2026-02-07" },
                    { name: "檢查2", name_en: "Outgoing Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2026-02-10" },
                    { name: "包裝與存放", name_en: "Packing & Storage", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2026-02-12" },
                ]
            },
            {
                id: "342406-06",
                rev: "A",
                tasks: [
                    { name: "市購件", name_en: "Purchased Parts", responsible: "採購課", responsible_en: "Purchasing", endDate: "2025-12-05" },
                    { name: "熱處理", name_en: "Heat Treatment", responsible: "供應商", responsible_en: "Supplier", endDate: "2025-12-11" },
                    { name: "噴砂", name_en: "Sandblasting", responsible: "供應商", responsible_en: "Supplier", endDate: "2025-12-15" },
                    { name: "鈍化", name_en: "Passivation", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2025-12-17" },
                    { name: "檢查1", name_en: "Final Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-19" },
                    { name: "檢查2", name_en: "Outgoing Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-23" },
                    { name: "包裝與存放", name_en: "Packing & Storage", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-25" },
                ]
            },
            {
                id: "342407-01",
                rev: "A",
                tasks: [
                    { name: "市購件", name_en: "Purchased Parts", responsible: "採購課", responsible_en: "Purchasing", endDate: "2025-12-29" },
                    { name: "熱處理", name_en: "Heat Treatment", responsible: "供應商", responsible_en: "Supplier", endDate: "2026-01-05" },
                    { name: "噴砂", name_en: "Sandblasting", responsible: "供應商", responsible_en: "Supplier", endDate: "2026-01-09" },
                    { name: "鈍化", name_en: "Passivation", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2026-01-14" },
                    { name: "檢查1", name_en: "Final Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2026-01-20" },
                    { name: "檢查2", name_en: "Outgoing Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2026-01-26" },
                ]
            },
            {
                id: "337025-01",
                rev: "A",
                tasks: [
                    { name: "市購件", name_en: "Purchased Parts", responsible: "採購課", responsible_en: "Purchasing", endDate: "2025-12-01" },
                    { name: "鈍化", name_en: "Passivation", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2025-12-03" },
                    { name: "鐵氟龍", name_en: "DryFilm", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2025-12-05" },
                    { name: "檢查1", name_en: "Final Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-09" },
                    { name: "檢查2", name_en: "Outgoing Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-11" },
                    { name: "包裝與存放", name_en: "Packing & Storage", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-15" },
                ]
            },
            {
                id: "337026-01",
                rev: "A",
                tasks: [
                    { name: "市購件", name_en: "Purchased Parts", responsible: "採購課", responsible_en: "Purchasing", endDate: "2025-12-02" },
                    { name: "鈍化", name_en: "Passivation", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2025-12-04" },
                    { name: "鐵氟龍", name_en: "DryFilm", responsible: "磨鉗課", responsible_en: "Grinding & Polishing", endDate: "2025-12-08" },
                    { name: "檢查1", name_en: "Final Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-10" },
                    { name: "檢查2", name_en: "Outgoing Inspection", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-12" },
                    { name: "包裝與存放", name_en: "Packing & Storage", responsible: "成品課", responsible_en: "Finished Goods", endDate: "2025-12-16" },
                ]
            }
        ];

        // 處理日期和任務期間
        const processedProjects = projects.map(p => {
            const tasksWithDates = p.tasks.map((task, index, arr) => {
                const endDate = new Date(task.endDate + 'T00:00:00');
                let startDate;
                if (index === 0) {
                    // 假設第一個任務的持續時間為5天
                    startDate = new Date(endDate);
                    startDate.setDate(startDate.getDate() - 5);
                } else {
                    // 後續任務的開始日期為前一個任務的結束日期
                    startDate = new Date(arr[index - 1].endDate + 'T00:00:00');
                }
                return { ...task, startDate, endDate };
            });
            return { ...p, tasks: tasksWithDates };
        });

        const container = document.getElementById('gantt-container');

        const COLORS = [
            'bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-red-500',
            'bg-yellow-500', 'bg-indigo-500', 'bg-pink-500', 'bg-teal-500'
        ];
        
        // 日期格式化輔助函數
        const formatDate = (date) => {
            return `${date.getMonth() + 1}/${date.getDate()}`;
        };

        processedProjects.forEach((project, projectIndex) => {
            const projectEl = document.createElement('div');
            projectEl.className = 'bg-white rounded-xl shadow-lg p-4 sm:p-6 overflow-x-auto';
            
            const allDates = project.tasks.flatMap(t => [t.startDate, t.endDate]);
            const minDate = new Date(Math.min(...allDates));
            minDate.setDate(minDate.getDate() - 2); // 留出一些緩衝空間
            const maxDate = new Date(Math.max(...allDates));
            maxDate.setDate(maxDate.getDate() + 2); // 留出一些緩衝空間

            const totalDays = (maxDate - minDate) / (1000 * 60 * 60 * 24);

            // 建立時間軸標頭
            let monthHeaders = '';
            let dayHeaders = '';
            let currentDate = new Date(minDate);
            let months = {};

            while(currentDate <= maxDate) {
                const month = currentDate.toLocaleString('default', { month: 'short' });
                const year = currentDate.getFullYear();
                const key = `${month} ${year}`;
                if(!months[key]) {
                    months[key] = 0;
                }
                months[key]++;
                dayHeaders += `<div class="text-center text-xs text-gray-500 border-r border-gray-200" style="min-width: 25px;">${currentDate.getDate()}</div>`;
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            for (const key in months) {
                const width = (months[key] / totalDays) * 100;
                monthHeaders += `<div class="text-center text-sm font-medium text-gray-700 border-b-2 border-gray-300" style="width: ${width}%">${key}</div>`;
            }

            let tasksHtml = '';
            project.tasks.forEach((task, index) => {
                const offsetDays = (task.startDate - minDate) / (1000 * 60 * 60 * 24);
                const durationDays = Math.max(1, (task.endDate - task.startDate) / (1000 * 60 * 60 * 24));
                
                const left = (offsetDays / totalDays) * 100;
                const width = (durationDays / totalDays) * 100;
                const color = COLORS[index % COLORS.length];

                tasksHtml += `
                    <!-- Task Row -->
                    <div class="flex items-center border-b border-gray-200 h-16 py-1">
                        <div class="w-1/3 sm:w-1/4 lg:w-1/5 pr-4 text-sm text-gray-700">
                            <p class="truncate font-medium">${task.name}</p>
                            <p class="truncate text-xs text-gray-500">${task.name_en}</p>
                            <p class="truncate text-xs text-gray-500 mt-1">${task.responsible} / ${task.responsible_en}</p>
                        </div>
                        <div class="w-2/3 sm:w-3/4 lg:w-4/5 h-full relative">
                            <div class="absolute top-1/2 -translate-y-1/2 h-8 ${color} rounded-md shadow-sm flex items-center justify-between px-2 text-white text-xs" 
                                 style="left: ${left}%; width: ${width}%; min-width: 50px;"
                                 title="${task.name} / ${task.name_en}: ${formatDate(task.startDate)} - ${formatDate(task.endDate)}">
                                 <span class="font-semibold truncate whitespace-nowrap">${task.name} (${task.name_en})</span>
                                 <span class="hidden sm:inline ml-2 opacity-80 whitespace-nowrap">${formatDate(task.startDate)} - ${formatDate(task.endDate)}</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            projectEl.innerHTML = `
                <div class="mb-4">
                    <h2 class="text-xl font-bold text-gray-900">專案 / Project: ${project.id}</h2>
                    <p class="text-sm text-gray-500">版本 / Rev: ${project.rev}</p>
                </div>
                <div class="w-full" style="min-width: 800px;">
                    <!-- Header: Task Names -->
                    <div class="flex items-center border-b-2 border-gray-300 h-10 bg-gray-50 rounded-t-lg">
                        <div class="w-1/3 sm:w-1/4 lg:w-1/5 pr-4 pl-4 text-sm font-semibold text-gray-600">任務/負責單位 (Task / Dept.)</div>
                        <div class="w-2/3 sm:w-3/4 lg:w-4/5 relative">
                            <!-- Timeline Header -->
                            <div class="flex">${monthHeaders}</div>
                            <div class="grid" style="grid-template-columns: repeat(${Math.ceil(totalDays)}, minmax(0, 1fr));">${dayHeaders}</div>
                        </div>
                    </div>
                    <!-- Tasks Container -->
                    <div>
                        ${tasksHtml}
                    </div>
                </div>
            `;
            container.appendChild(projectEl);
        });
    </script>
</body>
</html>

